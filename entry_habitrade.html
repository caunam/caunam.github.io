<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chiến Lược Giao Dịch Forex Habitrade</title>
<script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 30px auto 50px;
        max-width: 1000px;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }
    th, td {
        border: 1px solid black;
        padding: 8px;
        text-align: left;
    }
    th {
        background-color: #f2f2f2;
    }
    textarea {
        width: 100%;
        height: 100px;
        resize: none;
        margin-top: 10px;
    }
    /* Định nghĩa màu cho các thành phần được chọn và không được chọn */
    .support {
        background-color: #c7ecc7; /* Màu xanh lá */
    }
    .non-support {
        background-color: #ffc0cb; /* Màu hồng nhạt */
    }
    .selected {
        background-color: #ffffcc; /* Màu vàng nhạt */
    }
</style>
</head>
<body>
<h2>Chiến Lược Giao Dịch Forex Habitrade</h2>

<label for="transactionCode">Mã Giao Dịch:</label>
<select id="transactionCode">
    <option value="EURUSD">EURUSD</option>
    <option value="GBPUSD">GBPUSD</option>
    <option value="AUDUSD">AUDUSD</option>
    <option value="NZDUSD">NZDUSD</option>
    <option value="USDJPY">USDJPY</option>
    <option value="USDCAD">USDCAD</option>
    <option value="USDCHF">USDCHF</option>
    <option value="XAUUSD">XAUUSD</option>
    <!--Thêm các mã giao dịch khác vào đây-->
</select>

<p>Ngày Mở Lệnh: <input type="date" id="openDate"></p>
<p>Ngày Đóng Lệnh: <input type="date" id="closeDate"></p>

<p>
    <label for="transactionType">Loại Lệnh:</label>
    <select id="transactionType">
        <option value="BUY">BUY</option>
        <option value="SELL">SELL</option>
    </select>
</p>

<p>
    <label for="timeframe">Khung Thời Gian:</label>
    <select id="timeframe">
        <option value="M1">M1</option>
        <option value="M5">M5</option>
        <option value="M15">M15</option>
        <option value="M30">M30</option>
        <option value="H1">H1</option>
        <option value="H4">H4</option>
        <option value="D1">D1</option>
        <option value="W1">W1</option>
        <option value="MN">MN</option>
        <!--Thêm các khung thời gian khác vào đây-->
    </select>
</p>

<p>
    <label for="chartImage">Địa Chỉ Ảnh Biểu Đồ:</label>
    <input type="text" id="chartImage" placeholder="Nhập địa chỉ ảnh...">
</p>

<p>
    <label for="loseR">Thua (Theo R):</label>
    <input type="text" id="loseR" placeholder="Nhập số lượng R khi thua...">
</p>

<p>
    <label for="winR">Thắng (Theo R):</label>
    <input type="text" id="winR" placeholder="Nhập số lượng R khi thắng...">
</p>

<table>
    <thead>
        <tr>
            <th>Yếu Tố Ủng Hộ</th>
            <th>Yếu Tố Không Ủng Hộ</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td><input type="checkbox" id="trendSupport"> Giao Dịch Theo Xu Hướng</td>
            <td><input type="checkbox" id="trendNonSupport"> Giao Dịch Theo Xu Hướng</td>
        </tr>
        <tr>
            <td><input type="checkbox" id="keyLevelSupport"> Key Level</td>
            <td><input type="checkbox" id="keyLevelNonSupport"> Key Level</td>
        </tr>
        <tr>
            <td><input type="checkbox" id="trendlineSupport"> Trendline</td>
            <td><input type="checkbox" id="trendlineNonSupport"> Trendline</td>
        </tr>
        <tr>
            <td><input type="checkbox" id="strongMoveSupport"> Đà Tăng/Giảm Mạnh</td>
            <td><input type="checkbox" id="strongMoveNonSupport"> Đà Tăng/Giảm Mạnh</td>
        </tr>
        <tr>
            <td><input type="checkbox" id="waveSupport"> Đầu/Cuối Sóng</td>
            <td><input type="checkbox" id="waveNonSupport"> Đầu/Cuối Sóng</td>
        </tr>
        <tr>
            <td><input type="checkbox" id="maSupport"> Đường Trung Bình MA</td>
            <td><input type="checkbox" id="maNonSupport"> Đường Trung Bình MA</td>
        </tr>
        <tr>
            <td><input type="checkbox" id="fibonacciSupport"> Fibonacci</td>
            <td><input type="checkbox" id="fibonacciNonSupport"> Fibonacci</td>
        </tr>
        <tr>
            <td><input type="checkbox" id="confluenceZoneSupport"> Vùng Hợp Lưu</td>
            <td><input type="checkbox" id="confluenceZoneNonSupport"> Vùng Hợp Lưu</td>
        </tr>
        <tr>
            <td><input type="checkbox" id="candlePatternsSupport"> Mô Hình Nến</td>
            <td><input type="checkbox" id="candlePatternsNonSupport"> Mô Hình Nến</td>
        </tr>
        <tr>
            <td><input type="checkbox" id="chartPatternsSupport"> Mô Hình Biểu Đồ</td>
            <td><input type="checkbox" id="chartPatternsNonSupport"> Mô Hình Biểu Đồ</td>
        </tr>
        <tr>
            <td><input type="checkbox" id="largeTimeFrameSupport"> Khung Thời Gian Lớn</td>
            <td><input type="checkbox" id="largeTimeFrameNonSupport"> Khung Thời Gian Lớn</td>
        </tr>
        <tr>
            <td><input type="checkbox" id="timeFrameConfluenceSupport"> Hợp Lưu Các Khung Thời Gian</td>
            <td><input type="checkbox" id="timeFrameConfluenceNonSupport"> Hợp Lưu Các Khung Thời Gian</td>
        </tr>
    </tbody>
</table>

<textarea id="conclusion" placeholder="Nhập kết luận của bạn ở đây..."></textarea>

<p>
    <input type="checkbox" id="txtCheckbox">
    <label for="txtCheckbox">Tải về dưới dạng Văn bản (txt)</label>
</p>
<p>
    <input type="checkbox" id="excelCheckbox">
    <label for="excelCheckbox">Tải về dưới dạng Excel</label>
</p>

<!-- Thêm một phần tử div để chứa bảng hiển thị những thành phần được chọn -->
<div id="selectedItemsTable"></div>

<p>
    <button onclick="submitChecklist()">Tạo Chiến Lược</button>
</p>

<hr>

<p><a href="https://drive.google.com/drive/folders/1Fikehgh5DV0C2ckChgbvcT1kpiGCirtP?usp=drive_link">Tài liệu học tập</a></p>

<script>
function submitChecklist() {
    // Lấy dữ liệu từ các trường nhập liệu
    var transactionCode = document.getElementById('transactionCode').value;
    var openDate = document.getElementById('openDate').value;
    var closeDate = document.getElementById('closeDate').value;
    var transactionType = document.getElementById('transactionType').value;
    var timeframe = document.getElementById('timeframe').value;
    var chartImage = document.getElementById('chartImage').value;
    var loseR = document.getElementById('loseR').value;
    var winR = document.getElementById('winR').value;

    // Thu thập yếu tố ủng hộ và không ủng hộ
    var supports = [];
    document.querySelectorAll('td:nth-child(1) input:checked').forEach(function(item) {
        supports.push(item.parentElement.textContent.trim());
    });

    var nonSupports = [];
    document.querySelectorAll('td:nth-child(2) input:checked').forEach(function(item) {
        nonSupports.push(item.parentElement.textContent.trim());
    });

    // Lấy kết luận
    var conclusion = document.getElementById('conclusion').value;

    // Hiển thị những thành phần được chọn trong bảng
    displaySelectedItems(supports, nonSupports);

    // Kiểm tra checkbox để quyết định tải về dưới dạng Excel hay không
    var downloadExcel = document.getElementById('excelCheckbox').checked;

    // Kiểm tra checkbox để quyết định tải về dưới dạng Văn bản (txt) hay không
    var downloadTxt = document.getElementById('txtCheckbox').checked;

    console.log(supports.length);

    if (downloadExcel) {
        // Tạo dữ liệu cho tệp Excel
        var data = [
            ['Mã Giao Dịch', 'Ngày Mở Lệnh', 'Ngày Đóng Lệnh', 'Loại Lệnh', 'Khung Thời Gian', 'Địa Chỉ Ảnh Biểu Đồ', 'Thua (Theo R)', 'Thắng (Theo R)', 'Yếu Tố Ủng Hộ', 'Yếu Tố Không Ủng Hộ', 'Kết Luận'],
            [transactionCode, openDate, closeDate, transactionType, timeframe, chartImage, loseR, winR, supports.join('; '), nonSupports.join('; '), conclusion]
        ];

        // Tạo một workbook và tải về dưới dạng Excel
        var ws = XLSX.utils.aoa_to_sheet(data);
        var wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Checklist");
        XLSX.writeFile(wb, openDate.replace(/-/g, '') + '_' + closeDate.replace(/-/g, '') + '_' + transactionCode + '.xlsx');
    } else if (downloadTxt) {
        // Chuỗi format cho tệp văn bản
        var textContent = "";
        textContent += "Mã Giao Dịch: " + transactionCode + "\n";
        textContent += "Ngày Mở Lệnh: " + openDate + "\n";
        textContent += "Ngày Đóng Lệnh: " + closeDate + "\n";
        textContent += "Loại Lệnh: " + transactionType + "\n";
        textContent += "Khung Thời Gian: " + timeframe + "\n";
        textContent += "Địa Chỉ Ảnh Biểu Đồ: " + chartImage + "\n";
        textContent += "Thua (Theo R): " + loseR + "\n";
        textContent += "Thắng (Theo R): " + winR + "\n";
        textContent += "Yếu Tố Ủng Hộ:\n" + supports.map(function(item) { return "+ " + item; }).join('\n') + "\n";
        textContent += "Yếu Tố Không Ủng Hộ:\n" + nonSupports.map(function(item) { return "+ " + item; }).join('\n') + "\n";
        textContent += "\nKết Luận:\n" + conclusion;

        // Tạo một tệp văn bản và tải về
        var textFile = new Blob([textContent], { type: 'text/plain' });
        var downloadLink = document.createElement('a');
        downloadLink.download = openDate.replace(/-/g, '') + '_' + closeDate.replace(/-/g, '') + '_' + transactionCode + '.txt';
        downloadLink.href = window.URL.createObjectURL(textFile);
        downloadLink.style.display = 'none';
        document.body.appendChild(downloadLink);
        downloadLink.click();
        document.body.removeChild(downloadLink);
    }
}

// Hàm để hiển thị những thành phần được chọn trong bảng
function displaySelectedItems(supports, nonSupports) {
    var selectedItemsTable = document.getElementById('selectedItemsTable');
    var maxItemCount = Math.max(supports.length, nonSupports.length); // Số lượng phần tử nhiều nhất

    var tableHTML = "<h3>Thành Phần Được Chọn</h3><table><thead><tr><th>Yếu Tố Ủng Hộ (" + supports.length + "/12)</th><th>Yếu Tố Không Ủng Hộ (" + nonSupports.length + "/12)</th></tr></thead><tbody>";

    // Lặp qua số lượng phần tử nhiều nhất để đảm bảo mỗi hàng có số cột bằng nhau
    for (var i = 0; i < maxItemCount; i++) {
        // Kiểm tra nếu vẫn còn phần tử được chọn
        if (supports[i] || nonSupports[i]) {
            tableHTML += "<tr>";
            // Thêm phần tử ủng hộ nếu có
            if (supports[i]) {
                tableHTML += "<td class='support'>" + supports[i] + "</td>";
            } else {
                tableHTML += "<td></td>"; // Thêm cột trống nếu không có phần tử ủng hộ
            }
            // Thêm phần tử không ủng hộ nếu có
            if (nonSupports[i]) {
                tableHTML += "<td class='non-support'>" + nonSupports[i] + "</td>";
            } else {
                tableHTML += "<td></td>"; // Thêm cột trống nếu không có phần tử không ủng hộ
            }
            tableHTML += "</tr>";
        }
    }

    tableHTML += "</tbody></table>";
    selectedItemsTable.innerHTML = tableHTML;
}

// Thêm sự kiện click vào các thẻ <td>
document.querySelectorAll('td').forEach(function(td) {
    td.addEventListener('click', function() {
        // Tìm ô vuông checkbox trong cùng hàng và thay đổi trạng thái của nó
        var checkbox = this.querySelector('input[type="checkbox"]');
        if (checkbox) {
            checkbox.checked = !checkbox.checked;
            // Thêm hoặc loại bỏ lớp CSS 'selected' khi checkbox được checked hoặc unchecked
            if (checkbox.checked) {
                this.classList.add('selected');
            } else {
                this.classList.remove('selected');
            }
        }
    });
});


</script>
</body>
</html>
